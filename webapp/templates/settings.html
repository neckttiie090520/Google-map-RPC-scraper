{% extends "base.html" %}

{% block title %}‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - Google Maps Scraper{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center space-x-2">
            <span class="material-icons text-google-blue text-4xl">settings</span>
            <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </h1>
        <p class="text-gray-600">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    </div>

    <!-- Success Message (Hidden by default) -->
    <div id="success-message" class="hidden fixed top-6 right-6 z-50 max-w-md">
        <div class="relative bg-green-50 border border-green-200 rounded-xl p-5 shadow-2xl transform transition-all duration-300">
            <!-- Glow effect -->
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-green-400 to-emerald-400 opacity-10 blur-lg"></div>

            <div class="relative flex items-start space-x-4">
                <div class="flex-shrink-0 animate-bounce">
                    <div class="flex items-center justify-center w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full shadow-lg">
                        <span class="material-icons text-white text-xl">check</span>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-green-800 font-semibold text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á .env ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
                    <p class="text-green-600 text-xs mt-1 opacity-90">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>

                    <!-- Progress indicator -->
                    <div class="mt-2 flex items-center space-x-2">
                        <div class="flex-1 h-1 bg-green-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full animate-pulse-soft" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <button onclick="hideSuccessMessage()" class="flex-shrink-0 ml-2 text-green-600 hover:text-green-800 transition-colors duration-200 p-1 rounded-full hover:bg-green-100">
                    <span class="material-icons text-lg">close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Form -->
    <form id="settings-form" class="space-y-6">
        <!-- Language Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                <span class="material-icons text-google-blue text-xl">language</span>
                <span>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤</span>
            </h2>

            <div class="space-y-4">
                <!-- Single Language Region Setting -->
                <div>
                    <label for="language-region" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ
                    </label>
                    <select
                        id="language-region"
                        name="language_region"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue"
                    >
                        <option value="th-th">Thai (Thai Locale)</option>
                        <option value="en-th">English (Thai Locale)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>
        </div>

        <!-- Translation Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                <span class="material-icons text-purple-600 text-xl">translate</span>
                <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤</span>
            </h2>

            <div class="space-y-4">
                <!-- Enable Translation -->
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" id="enable-translation" name="enable_translation" class="w-4 h-4 text-purple-600">
                        <div>
                            <p class="text-sm font-medium text-gray-700">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤</p>
                            <p class="text-xs text-gray-500">‡πÅ‡∏õ‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </label>
                </div>

                <!-- Translation Options (Initially hidden) -->
                <div id="translation-options" class="hidden space-y-4 pl-7 border-l-2 border-purple-200">
                    <!-- Target Language -->
                    <div>
                        <label for="target-language" class="block text-sm font-medium text-gray-700 mb-2">
                            ‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•
                        </label>
                        <select
                            id="target-language"
                            name="target_language"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"
                        >
                            <option value="th">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                            <option value="en">English (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡πÄ‡∏õ‡πá‡∏ô</p>
                    </div>

                    <!-- Translation Content -->
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-3">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•:</p>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-3">
                                <input type="checkbox" id="translate-review-text" name="translate_review_text" class="w-4 h-4 text-purple-600" checked>
                                <div>
                                    <p class="text-sm text-gray-700">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>
                                    <p class="text-xs text-gray-500">‡πÅ‡∏õ‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3">
                                <input type="checkbox" id="translate-owner-response" name="translate_owner_response" class="w-4 h-4 text-purple-600">
                                <div>
                                    <p class="text-sm text-gray-700">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
                                    <p class="text-xs text-gray-500">‡πÅ‡∏õ‡∏•‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Batch Size -->
                    <div>
                        <label for="translation-batch-size" class="block text-sm font-medium text-gray-700 mb-2">
                            ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏• (Batch Size)
                        </label>
                        <select
                            id="translation-batch-size"
                            name="translation_batch_size"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"
                        >
                            <option value="10">10 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß/‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</option>
                            <option value="25">25 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß/‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏£‡πá‡∏ß)</option>
                            <option value="50" selected>50 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß/‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏õ‡∏Å‡∏ï‡∏¥)</option>
                            <option value="100">100 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß/‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏Ñ‡∏á‡∏ó‡∏ô)</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏à‡∏∞‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏Å</p>
                    </div>

                    <!-- Enhanced Detection -->
                    <div>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="use-enhanced-detection" name="use_enhanced_detection" class="w-4 h-4 text-purple-600" checked>
                            <div>
                                <p class="text-sm font-medium text-gray-700">‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</p>
                                <p class="text-xs text-gray-500">‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 10+ ‡∏†‡∏≤‡∏©‡∏≤)</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Translation Info -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <span class="material-icons text-purple-600 mt-0.5">info</span>
                        <div class="text-sm text-purple-800">
                            <p class="font-medium mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•:</p>
                            <ul class="text-xs space-y-1 list-disc list-inside">
                                <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏à‡∏≤‡∏Å 10+ ‡∏†‡∏≤‡∏©‡∏≤ (‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ, ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô, ‡∏à‡∏µ‡∏ô, ‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™, ‡∏™‡πÄ‡∏õ‡∏ô, ‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô, ‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢, ‡∏≠‡∏≤‡∏£‡∏ö‡∏¥‡∏Å, ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô)</li>
                                <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•: ~99.3% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (English) ~100% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Thai)</li>
                                <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡πÅ‡∏ö‡∏ö Real-time ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Tasks</li>
                                <li>‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Translation Status Alert -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <span class="material-icons text-red-600 mt-0.5">error</span>
                        <div class="text-sm text-red-800">
                            <p class="font-medium mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•: <span class="text-red-600 font-bold">‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span></p>
                            <ul class="text-xs space-y-1 list-disc list-inside">
                                <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ: <code class="bg-red-100 px-1 rounded">'float' object has no attribute 'as_dict'</code></li>
                                <li>‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</li>
                                <li>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏â‡∏ö‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</li>
                                <li>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                <span class="material-icons text-google-blue text-xl">search</span>
                <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span>
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Max Search Results -->
                <div>
                    <label for="max-search-results" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </label>
                    <input
                        type="number"
                        id="max-search-results"
                        name="max_search_results"
                        min="1"
                        max="50"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue"
                    >
                    <p class="text-xs text-gray-500 mt-1">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 10-20 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: 50)</p>
                </div>

              </div>
        </div>

        <!-- Scraping Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                <span class="material-icons text-google-blue text-xl">content_copy</span>
                <span>‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</span>
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Max Reviews -->
                <div>
                    <label for="max-reviews" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
                    </label>
                    <div class="flex items-center space-x-3">
                        <input
                            type="number"
                            id="max-reviews"
                            name="max_reviews"
                            min="10"
                            max="10000"
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue"
                        >
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="unlimited-reviews" class="w-4 h-4 text-google-blue">
                            <span class="text-sm text-gray-700">‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
                        </label>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 100-500 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß (‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î = ‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</p>
                </div>

                <!-- Date Range -->
                <div>
                    <label for="date-range" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                    </label>
                    <select
                        id="date-range"
                        name="date_range"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue mb-3"
                        onchange="toggleCustomDateRange()"
                    >
                        <option value="1month">1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="6months">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="1year" selected>1 ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="5years">5 ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                    </select>

                    <!-- Custom Date Range Fields (Hidden by default) -->
                    <div id="custom-date-range" class="hidden space-y-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1">
                                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                                </label>
                                <input
                                    type="date"
                                    id="start-date"
                                    name="start_date"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-google-blue"
                                    max=""
                                >
                            </div>
                            <div>
                                <label for="end-date" class="block text-sm font-medium text-gray-700 mb-1">
                                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
                                </label>
                                <input
                                    type="date"
                                    id="end-date"
                                    name="end_date"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-google-blue"
                                    max=""
                                >
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">
                            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                        </p>
                    </div>
                </div>

                </div>
        </div>

        <!-- Advanced Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                <span class="material-icons text-google-blue text-xl">tune</span>
                <span>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</span>
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Auto-save -->
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" id="auto-save" name="auto_save" class="w-4 h-4 text-google-blue">
                        <div>
                            <p class="text-sm font-medium text-gray-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                            <p class="text-xs text-gray-500">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                        </div>
                    </label>
                </div>

                <!-- Show Notifications -->
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" id="show-notifications" name="show_notifications" class="w-4 h-4 text-google-blue">
                        <div>
                            <p class="text-sm font-medium text-gray-700">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                            <p class="text-xs text-gray-500">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                        </div>
                    </label>
                </div>

                <!-- Auto-refresh -->
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" id="auto-refresh" name="auto_refresh" class="w-4 h-4 text-google-blue">
                        <div>
                            <p class="text-sm font-medium text-gray-700">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                            <p class="text-xs text-gray-500">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                        </div>
                    </label>
                </div>

                <!-- Export Format -->
                <div>
                    <label for="default-export" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    </label>
                    <select
                        id="default-export"
                        name="default_export"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue"
                    >
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                        <option value="both">‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <div class="flex justify-between">
                <button
                    type="button"
                    onclick="resetToDefaults()"
                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-2"
                >
                    <span class="material-icons text-xl">restore</span>
                    <span>‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
                </button>

                <div class="flex items-center space-x-3">
                    <button
                        type="button"
                        onclick="exportSettings()"
                        class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-2"
                    >
                        <span class="material-icons text-xl">file_download</span>
                        <span>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </button>
                    <button
                        type="button"
                        onclick="importSettings()"
                        class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-2"
                    >
                        <span class="material-icons text-xl">file_upload</span>
                        <span>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </button>
                    <button
                        type="submit"
                        class="px-6 py-2 bg-google-blue hover:bg-blue-600 text-white rounded-lg flex items-center space-x-2 shadow-md"
                    >
                        <span class="material-icons text-xl">save</span>
                        <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- Import Settings Modal -->
    <div id="import-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
            </div>
            <div class="p-6">
                <input
                    type="file"
                    id="import-file"
                    accept=".json"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-google-blue"
                >
                <p class="text-xs text-gray-500 mt-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ß‡πâ</p>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button
                    onclick="closeImportModal()"
                    class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
                >
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button
                    onclick="processImport()"
                    class="px-4 py-2 bg-google-blue hover:bg-blue-600 text-white rounded-lg"
                >
                    ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Default settings
    const defaultSettings = {
        max_search_results: 10,
        language_region: 'en-th',
        max_reviews: 100,
        unlimited_reviews: false,
        date_range: '1year',
        start_date: null,
        end_date: null,
        auto_save: true,
        show_notifications: true,
        auto_refresh: true,
        default_export: 'csv',
        enable_translation: false,
        target_language: 'th',
        translate_review_text: true,
        translate_owner_response: false,
        translation_batch_size: 50,
        use_enhanced_detection: true
    };

    // Load settings from localStorage (with fallback to .env)
    function loadSettings() {
        const saved = localStorage.getItem('scraper_settings');
        return saved ? { ...defaultSettings, ...JSON.parse(saved) } : { ...defaultSettings };
    }

    // Load settings from .env file
    function loadSettingsFromEnv() {
        console.log('Loading settings from .env file...');
        return fetch('/api/settings')
            .then(response => {
                console.log('API response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('API response data:', data);
                if (data.success) {
                    console.log('‚úÖ Settings loaded from .env file:', data.settings);
                    return data.settings;
                } else {
                    console.error('‚ùå Failed to load settings from .env:', data.error);
                    return defaultSettings;
                }
            })
            .catch(error => {
                console.error('‚ùå Error loading settings from .env:', error);
                return defaultSettings;
            });
    }

    // Save settings to localStorage and .env file
    function saveSettings(settings) {
        // Save to localStorage (existing functionality)
        localStorage.setItem('scraper_settings', JSON.stringify(settings));

        // Also save to .env file via API
        fetch('/api/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ settings: settings })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Settings saved to .env file:', data.message);
            } else {
                console.error('Failed to save settings to .env:', data.error);
            }
        })
        .catch(error => {
            console.error('Error saving settings to .env:', error);
        });
    }

    // Populate form with settings
    function populateForm(settings) {
        console.log('üìù Populating form with settings:', settings);

        // Debug specific problematic fields
        console.log('üî¢ Max Reviews Settings Check:');
        console.log('  - settings.max_reviews:', settings.max_reviews);
        console.log('  - settings.unlimited_reviews:', settings.unlimited_reviews);
        console.log('  - type of max_reviews:', typeof settings.max_reviews);

        document.getElementById('max-search-results').value = settings.max_search_results;
        document.getElementById('language-region').value = settings.language_region;

        // Enhanced debugging for max reviews
        const maxReviewsInput = document.getElementById('max-reviews');
        console.log('  - Max reviews input element found:', !!maxReviewsInput);
        console.log('  - Setting max_reviews value to:', settings.max_reviews);
        maxReviewsInput.value = settings.max_reviews;
        console.log('  - Max reviews input value after setting:', maxReviewsInput.value);

        document.getElementById('unlimited-reviews').checked = settings.unlimited_reviews;

        // Verify unlimited reviews handling
        if (settings.unlimited_reviews) {
            console.log('  - ‚úÖ Unlimited reviews checked - disabling input');
            maxReviewsInput.value = 10000;
            maxReviewsInput.disabled = true;
        } else {
            console.log('  - ‚úÖ Limited reviews mode - input value:', maxReviewsInput.value);
            maxReviewsInput.disabled = false;
        }

        document.getElementById('date-range').value = settings.date_range;
        document.getElementById('auto-save').checked = settings.auto_save;
        document.getElementById('show-notifications').checked = settings.show_notifications;
        document.getElementById('auto-refresh').checked = settings.auto_refresh;
        document.getElementById('default-export').value = settings.default_export;

        // Translation settings
        document.getElementById('enable-translation').checked = settings.enable_translation;
        document.getElementById('target-language').value = settings.target_language;
        document.getElementById('translate-review-text').checked = settings.translate_review_text;
        document.getElementById('translate-owner-response').checked = settings.translate_owner_response;
        document.getElementById('translation-batch-size').value = settings.translation_batch_size;
        document.getElementById('use-enhanced-detection').checked = settings.use_enhanced_detection;

        // Handle custom date range
        if (settings.date_range === 'custom' && settings.start_date && settings.end_date) {
            document.getElementById('start-date').value = settings.start_date;
            document.getElementById('end-date').value = settings.end_date;
        }

        // Toggle custom date range visibility
        toggleCustomDateRange();

        // Toggle translation options visibility
        toggleTranslationOptions();

        // Handle unlimited reviews checkbox
        handleUnlimitedReviews();

        console.log('‚úÖ Form population completed');
    }

    // Get settings from form
    function getFormSettings() {
        const dateRange = document.getElementById('date-range').value;
        const languageRegion = document.getElementById('language-region').value;

        return {
            max_search_results: parseInt(document.getElementById('max-search-results').value),
            language_region: languageRegion,
            max_reviews: parseInt(document.getElementById('max-reviews').value),
            unlimited_reviews: document.getElementById('unlimited-reviews').checked,
            date_range: dateRange,
            // Add custom dates for custom date range
            start_date: dateRange === 'custom' ? document.getElementById('start-date').value : null,
            end_date: dateRange === 'custom' ? document.getElementById('end-date').value : null,
            auto_save: document.getElementById('auto-save').checked,
            show_notifications: document.getElementById('show-notifications').checked,
            auto_refresh: document.getElementById('auto-refresh').checked,
            default_export: document.getElementById('default-export').value,
            // Translation settings
            enable_translation: document.getElementById('enable-translation').checked,
            target_language: document.getElementById('target-language').value,
            translate_review_text: document.getElementById('translate-review-text').checked,
            translate_owner_response: document.getElementById('translate-owner-response').checked,
            translation_batch_size: parseInt(document.getElementById('translation-batch-size').value),
            use_enhanced_detection: document.getElementById('use-enhanced-detection').checked
        };
    }

    // Handle unlimited reviews checkbox
    function handleUnlimitedReviews() {
        const maxReviewsInput = document.getElementById('max-reviews');
        const unlimitedCheckbox = document.getElementById('unlimited-reviews');

        if (unlimitedCheckbox.checked) {
            maxReviewsInput.value = 10000;
            maxReviewsInput.disabled = true;
        } else {
            maxReviewsInput.value = 100;
            maxReviewsInput.disabled = false;
        }
    }

    // Reset to defaults
    function resetToDefaults() {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?')) {
            populateForm(defaultSettings);
            saveSettings(defaultSettings);
            showSuccessMessage('‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
    }

    // Toggle custom date range visibility
    function toggleCustomDateRange() {
        const dateRangeSelect = document.getElementById('date-range');
        const customDateRangeDiv = document.getElementById('custom-date-range');
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');

        if (dateRangeSelect.value === 'custom') {
            customDateRangeDiv.classList.remove('hidden');
            // Set max date to today
            const today = new Date().toISOString().split('T')[0];
            startDateInput.max = today;
            endDateInput.max = today;

            // Set default dates if empty (last 30 days)
            if (!startDateInput.value) {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
            }
            if (!endDateInput.value) {
                endDateInput.value = today;
            }
        } else {
            customDateRangeDiv.classList.add('hidden');
        }
    }

    // Toggle translation options visibility
    function toggleTranslationOptions() {
        const enableTranslationCheckbox = document.getElementById('enable-translation');
        const translationOptionsDiv = document.getElementById('translation-options');

        if (enableTranslationCheckbox.checked) {
            translationOptionsDiv.classList.remove('hidden');
        } else {
            translationOptionsDiv.classList.add('hidden');
        }
    }

    // Export settings
    function exportSettings() {
        const settings = getFormSettings();
        const dataStr = JSON.stringify(settings, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

        const exportFileDefaultName = `scraper-settings-${new Date().toISOString().split('T')[0]}.json`;

        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();

        showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
    }

    // Import settings
    function importSettings() {
        document.getElementById('import-modal').classList.remove('hidden');
    }

    // Close import modal
    function closeImportModal() {
        document.getElementById('import-modal').classList.add('hidden');
        document.getElementById('import-file').value = '';
    }

    // Process import
    function processImport() {
        const fileInput = document.getElementById('import-file');
        const file = fileInput.files[0];

        if (!file) {
            showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå', 'error');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const settings = JSON.parse(e.target.result);
                populateForm(settings);
                saveSettings(settings);
                closeImportModal();
                showSuccessMessage('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } catch (error) {
                showAlert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
        };
        reader.readAsText(file);
    }

    // Show success message with enhanced popup
    function showSuccessMessage(message) {
        const successDiv = document.getElementById('success-message');
        const messageText = successDiv.querySelector('.text-green-800');

        // Update message if provided
        if (message && message !== '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á .env ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢') {
            messageText.textContent = message;
            // Hide subtitle for custom messages
            const subtitle = successDiv.querySelector('.text-green-600');
            if (subtitle) subtitle.style.display = 'none';
        } else {
            messageText.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á .env ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
            // Show subtitle for default message
            const subtitle = successDiv.querySelector('.text-green-600');
            if (subtitle) subtitle.style.display = 'block';
        }

        // Show popup with animation
        successDiv.classList.remove('hidden');
        successDiv.classList.add('animate-slide-in');

        // Remove animation class after animation completes
        setTimeout(() => {
            successDiv.classList.remove('animate-slide-in');
        }, 300);

        // Auto-hide after 4 seconds
        setTimeout(() => {
            hideSuccessMessage();
        }, 4000);
    }

    // Hide success message with animation
    function hideSuccessMessage() {
        const successDiv = document.getElementById('success-message');
        successDiv.classList.add('animate-slide-out');

        setTimeout(() => {
            successDiv.classList.add('hidden');
            successDiv.classList.remove('animate-slide-out');
        }, 300);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Settings page initialization started...');

        // Load settings from .env file first, then merge with localStorage
        loadSettingsFromEnv().then(envSettings => {
            console.log('üì• Loaded from .env:', envSettings);

            const localSettings = loadSettings();
            console.log('üíæ Loaded from localStorage:', localSettings);

            // Merge: local settings as base, env settings as override (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ .env ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
            const finalSettings = { ...localSettings, ...envSettings };
            console.log('üîÄ Final merged settings (with .env priority):', finalSettings);

            // Save merged settings to localStorage for consistency
            localStorage.setItem('scraper_settings', JSON.stringify(finalSettings));
            console.log('üíæ Saved merged settings to localStorage');

            // Populate form with merged settings
            populateForm(finalSettings);
            console.log('‚úÖ Form populated with settings');

        }).catch(error => {
            console.error('‚ùå Error loading settings from .env, using localStorage only:', error);

            // Fallback to localStorage only
            const settings = loadSettings();
            console.log('üì¶ Using localStorage settings:', settings);
            populateForm(settings);
        });

        // Setup form submit
        document.getElementById('settings-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const formSettings = getFormSettings();
            saveSettings(formSettings);
            showSuccessMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á .env ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        });

        // Setup unlimited reviews checkbox
        document.getElementById('unlimited-reviews').addEventListener('change', handleUnlimitedReviews);

        // Setup translation enable checkbox
        document.getElementById('enable-translation').addEventListener('change', toggleTranslationOptions);

        // Setup max reviews validation
        document.getElementById('max-reviews').addEventListener('input', function(e) {
            const value = parseInt(e.target.value);
            if (value < 10) e.target.value = 10;
            if (value > 10000) e.target.value = 10000;
        });

        // Setup max search results validation
        document.getElementById('max-search-results').addEventListener('input', function(e) {
            const value = parseInt(e.target.value);
            if (value < 1) e.target.value = 1;
            if (value > 50) e.target.value = 50;
        });

        // Setup translation batch size validation
        document.getElementById('translation-batch-size').addEventListener('input', function(e) {
            const value = parseInt(e.target.value);
            if (value < 10) e.target.value = 10;
            if (value > 100) e.target.value = 100;
        });
    });
</script>
{% endblock %}
